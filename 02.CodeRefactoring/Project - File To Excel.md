---
date: 2024-04-15
title: File To Excel_CodeRefactoring
tags:
  - Refactoring
  - code
  - python
---
# 2024년 2월 작성되었던 코드의 리팩터링 및 리디자인 및 성능 개선 작업

### 찾고자 하는 확장자의 경로를 엑셀 목록으로 뽑아서 저장해주는 프로그램
소규모 회사에서 학교측으로 회사에서 사용하는 공유서버 윈도우 컴퓨터에 파일들이 많이 저장되어있는데, 폴더 경로들이 정리되어있지 않았기에 필요한 문서를 찾기 어렵다는 문제상황이 들어왔고, 이를 임시방편적으로 해결하고자 엑셀로 내가 찾고자 하는 확장자의 명이 들어가 있는 폴더의 전체 절대경로를 직접 엑셀화 시켜주는 프로그램을 작성했었다.

## 문제점
- ptyhon의 `os.walk()` 함수를 사용하여 모든 하위 디렉토리를 순회하고 있어서 오래걸린다는 문제점이 발생하였다.
- 오래걸리다보니 사용자가 다른 입력을 넣게되면 프로그램이 강제로 종료되는 경우도 심심치않게 발견되었다.

### 이를 해결하기 위해 코드 리팩터링을 진행한다.


#### 해결책
1. 병렬 처리 도입 (multiprocessing 사용)
2. 진행 상황 표시 추가
3. 불필요한 디렉토리 건너뛰기 옵션 추가
##### 위 문제를 적용했을때, 발생 할 수 있는 문제점
1. 멀티프로세싱 도입
	- CPU의 모든 코어를 활용하여 파일 처리
	- 각 파일을 병렬로 처리하여 속도 향상
2. 진행 상황 표시
	- 프로그레스 바로 진행 상황을 시각적으로 표시
	- 현재 처리 중인 파일 수 표시
3. 파일 처리 최적화
	- pathlib 사용으로 경로 처리 성능 향상
	- 파일 목록을 먼저 수집한 후 처리
4. 에러 처리 개선
	- 개별 파일 처리 실패 시에도 전체 프로세스 계속 진행
5. pathlib 사용으로 경로 처리 최적화
	- 객체 지향 방식
	- 운영체제에 독립적인 경로처리 가능(OS에 구애받지 않음)
	- 재귀 순회와 필터링이 쉬움
	- 타 라이브러리와 호환성 좋음
6. 개별 파일 처리 함수 분리로 병렬 처리 가능
	- 병렬처리로 인해 작업속도 향상.
7. 파일 검색 로직 분리로 메모리 효율성 개선
	- 검색의 로직을 분리함으로써 작업을 빠르게 처리가능
8. 진행 상황 표시 UI 추가
	- 진행 프로그래스 바 생성
	- 사용자의 편의성을 위해 프로그래스 바 도입
9. 멀티프로세싱 구현으로 처리 속도 대폭 향상
	- `num_processes = max(1, multiprocessing.cpu_count() - 1)`
	- 프로세스 수 설정 CPU 기반으로 돌아감.
10. ProcessPoolExecutor 사용으로 안정적인 병렬 처리
	- `ProcessPoolExecutor` 를 사용하여 멀티코어 CPU를 적극 활용해서 프로그램을 더 빠르게 실행 시킬 수 있음
	- 특히 Python에서 GIL(Global Interpreter Lock) 때문에 멀티스레딩이 한계를 가지는데,  멀티프로세싱으로 극복할 수 있게 해줌